<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script type="text/javascript" charset="UTF-8" src="https://mbwac.dev-mobilus.chat/web/mobi-agent-client-frame-loader.min.js?domainId=iimuratest2"></script>
    <script>
        //本体読み込み
    document.addEventListener("DOMContentLoaded", function() {
    MobiAgentClient.init(
        'https://mbwac.dev-mobilus.chat', // server url
        'iimuratest2', // domainId
        {}, // options
        function(){
            // MobiAgentClient初期化後にiframe内の要素を処理
            setTimeout(() => {
                const iframe = document.querySelector('iframe');
                console.log('iframe要素:', iframe);
                
                if (iframe) {
                    // iframeが既に読み込まれている場合の処理
                    const processIframeContent = () => {
                        try {
                            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                            console.log('iframeDoc:', iframeDoc);

                            // 対象の要素を取得
                            const targetElement = iframeDoc.querySelector('.mbaGuestFrame_trigger_inner_header3');
                            console.log('対象要素:', targetElement);

                            if (targetElement) {
                                console.log('対象要素が見つかりました。リンクを作成します。');
                                
                                // 既にリンクが追加されていないかチェック
                                const existingLink = iframeDoc.querySelector('a[href="https://mobilus.co.jp/"]');
                                if (existingLink) {
                                    console.log('リンクは既に存在します');
                                    return;
                                }
                                
                                // <a>タグを作成
                                const link = iframeDoc.createElement('a');
                                link.href = 'https://mobilus.co.jp/';
                                link.textContent = 'サポートページ';
                                link.target = '_blank';
                                link.style.display = 'block';
                                link.style.marginTop = '10px';
                                link.style.color = 'blue';
                                link.style.textDecoration = 'underline';
                                
                                console.log('作成されたリンク:', link);

                                // 対象要素の直後に挿入
                                if (targetElement.nextSibling) {
                                    targetElement.parentNode.insertBefore(link, targetElement.nextSibling);
                                    console.log('nextSiblingの前に挿入しました');
                                } else {
                                    targetElement.parentNode.appendChild(link);
                                    console.log('parentNodeに追加しました');
                                }
                                
                                // 挿入後の確認
                                console.log('挿入後のparentNode:', targetElement.parentNode);
                                console.log('iframe内のリンク要素:', iframeDoc.querySelector('a[href="https://mobilus.co.jp/"]'));
                            } else {
                                console.warn('iframe内に指定されたクラス名の要素が見つかりませんでした');
                                console.log('iframe内の全ての要素:', iframeDoc.body ? iframeDoc.body.innerHTML : 'bodyが見つかりません');
                            }
                        } catch (error) {
                            console.error('iframe内容へのアクセスエラー:', error);
                        }
                    };

                    // 即座に一度試行
                    processIframeContent();

                    // iframe内の変更を監視
                    const observer = new MutationObserver(() => {
                        processIframeContent();
                    });

                    // iframe自体の変更を監視
                    observer.observe(document.body, {
                        childList: true,
                        subtree: true
                    });

                    // iframe内部の監視も設定（可能な場合）
                    try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        if (iframeDoc && iframeDoc.body) {
                            observer.observe(iframeDoc.body, {
                                childList: true,
                                subtree: true
                            });
                        }
                    } catch (error) {
                        console.log('iframe内部の監視設定に失敗:', error);
                    }

                    // loadイベントも念のため設定
                    iframe.addEventListener('load', processIframeContent);
                } else {
                    console.warn('iframe要素が見つかりませんでした');
                }
            }, 1000); // 1秒待機してからiframe要素を探す
        } // callback
    );
    });
    </script>
</body>
</html>
